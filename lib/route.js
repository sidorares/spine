//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91dGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvcm91dGUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Q0FBQSxLQUFBLG1EQUFBO0tBQUE7O3VCQUFBO0NBQUE7Q0FBQSxDQUFBLENBQVEsQ0FBQyxDQUFULEVBQWtCOztDQUFsQixDQUNBLENBQVEsRUFBSzs7Q0FEYixDQUdBLENBQWUsRUFIZixJQUdBOztDQUhBLENBSUEsQ0FBZSxPQUFmLEdBSkE7O0NBQUEsQ0FLQSxDQUFlLE9BQWYsSUFMQTs7Q0FBQSxDQU1BLENBQWUsU0FBZixhQU5BOztDQUFBLENBUU0sR0FBSztDQUNULEdBQUEsSUFBQTtDQUFBO0NBQUE7O0NBQUEsR0FBQSxDQUFDLENBQUQ7O0NBQUEsRUFFaUIsQ0FBakIsQ0FBQyxTQUFELHFEQUZBOztDQUFBLENBQUEsQ0FJUyxDQUFULENBQUMsQ0FBRDs7Q0FKQSxFQU9DLENBREQsQ0FBQyxFQUFEO0NBQ0MsQ0FBVSxFQUFWLEVBQUMsQ0FBQTtDQUFELENBQ1UsR0FEVixDQUNDLENBQUE7Q0FERCxDQUVPLEVBQU4sQ0FGRCxDQUVDO0NBRkQsQ0FHVSxHQUhWLENBR0MsQ0FBQTtDQVZGLEtBQUE7O0NBQUEsQ0FZYSxDQUFiLENBQUEsQ0FBQyxHQUFLLENBQUM7Q0FDTCxTQUFBLFVBQUE7QUFBSSxDQUFKLEdBQUksQ0FBZSxDQUFuQixFQUFJLElBQWdEO0FBQ2xELENBQUE7V0FBQSxHQUFBOzZCQUFBO0NBQUEsQ0FBVSxDQUFWLENBQUMsQ0FBRDtDQUFBO3lCQURGO01BQUEsRUFBQTtDQUdHLENBQXdCLEVBQXhCLEVBQU0sRUFBVSxPQUFqQjtRQUpFO0NBWk4sSUFZTTs7Q0FaTixFQWtCUSxDQUFSLENBQUMsRUFBTyxFQUFDOztHQUFVLEtBQVY7UUFDUDtDQUFBLENBQVcsQ0FBQSxDQUFWLEVBQUQsQ0FBQTtDQUVBLEdBQUksRUFBSixDQUFZO0NBQ1YsRUFBVyxDQUFWLEdBQUQsQ0FBQSxNQUFXO1FBSGI7Q0FLQSxHQUFVLEVBQVYsQ0FBa0I7Q0FBbEIsYUFBQTtRQUxBO0NBT0EsR0FBRyxFQUFILENBQUE7Q0FDRSxDQUEyQixFQUEzQixFQUFBLEVBQUEsRUFBQTtNQURGLEVBQUE7Q0FHRSxDQUE2QixFQUE3QixFQUFBLEVBQUEsSUFBQTtRQVZGO0NBV0MsR0FBQSxFQUFELE9BQUE7Q0E5QkYsSUFrQlE7O0NBbEJSLEVBZ0NTLENBQVQsQ0FBQyxDQUFELEdBQVM7Q0FDUCxHQUFVLEVBQVYsQ0FBa0I7Q0FBbEIsYUFBQTtRQUFBO0NBRUEsR0FBRyxFQUFILENBQUE7Q0FDRSxDQUE2QixFQUFDLEVBQTlCLElBQUEsS0FBQTtNQURGLEVBQUE7Q0FHRSxDQUErQixFQUFDLEVBQWhDLE1BQUEsR0FBQTtRQU5LO0NBaENULElBZ0NTOztDQWhDVCxFQXdDVyxDQUFYLENBQUMsR0FBRCxDQUFXO0NBQ1QsU0FBQSxrQkFBQTtDQUFBLEtBRFUsaURBQ1Y7Q0FBQSxDQUFBLENBQVUsR0FBVixDQUFBO0NBQUEsRUFFVSxDQUFLLEVBQWYsQ0FBQTtBQUNHLENBQUgsR0FBRyxDQUFrQixDQUFyQixDQUFHLENBQUg7Q0FDRSxFQUFVLENBQUksR0FBZCxDQUFBO0FBQ00sQ0FBQSxHQUFBLENBQWtCLENBRjFCLENBRVEsQ0FGUixDQUFBO0NBR0UsRUFBa0IsQ0FBSSxHQUFmLENBQVA7UUFORjtDQUFBLENBUVUsQ0FBQSxDQUFjLEVBQXhCLENBQUE7Q0FSQSxFQVVPLENBQVAsRUFBQTtDQUNBLEdBQVUsQ0FBUyxDQUFuQjtDQUFBLGFBQUE7UUFYQTtDQUFBLEVBWVEsQ0FBUCxFQUFEO0NBWkEsQ0FjcUIsRUFBcEIsRUFBRCxDQUFBLEdBQUE7Q0FFQSxHQUErQixFQUEvQixDQUFzQztDQUF0QyxDQUFtQixFQUFsQixHQUFELENBQUEsRUFBQTtRQWhCQTtDQWtCQSxHQUFVLEVBQVYsQ0FBaUI7Q0FBakIsYUFBQTtRQWxCQTtDQW9CQSxHQUFHLEVBQUgsQ0FBRztDQUNPLENBQVIsRUFBMEMsQ0FBMUMsRUFBTyxDQUEwQixJQUFqQyxHQUFBO0NBQ08sR0FBRCxFQUZSLENBQUEsQ0FBQTtDQUdVLENBQVIsRUFBdUMsQ0FBdkMsRUFBTyxDQUF1QixDQUE5QixNQUFBO01BSEYsRUFBQTtDQUtTLEVBQWdCLENBQXZCLEVBQU0sRUFBUyxPQUFmO1FBMUJPO0NBeENYLElBd0NXOztDQXhDWCxFQXNFVSxDQUFWLENBQUMsRUFBRCxFQUFVO0NBQ1IsR0FBQSxNQUFBO0NBQUEsR0FBRyxFQUFILENBQUE7Q0FDRSxFQUFPLENBQVAsRUFBYSxFQUFiO0NBQ0EsQ0FBbUMsQ0FBbkMsQ0FBcUIsQ0FBc0IsQ0FBdEIsRUFBckI7Q0FBQSxFQUFPLENBQVAsTUFBQTtVQUZGO01BQUEsRUFBQTtDQUlFLEVBQU8sQ0FBUCxFQUFhLEVBQWI7Q0FBQSxDQUMrQixDQUF4QixDQUFQLEdBQU8sQ0FBUCxDQUFPO1FBTFQ7Q0FEUSxZQU9SO0NBN0VGLElBc0VVOztDQXRFVixFQStFVSxDQUFWLENBQUMsRUFBRCxFQUFVO0NBQ0MsQ0FBVCxDQUFFLENBQUYsRUFBUSxFQUFTLEtBQWpCO0NBaEZGLElBK0VVOztDQS9FVixFQWtGUyxDQUFULENBQUMsQ0FBRCxHQUFTO0NBQ1AsR0FBQSxNQUFBO0NBQUEsRUFBTyxDQUFQLEVBQUEsQ0FBTztDQUNQLEdBQVUsQ0FBUSxDQUFsQjtDQUFBLGFBQUE7UUFEQTtDQUFBLEVBRVEsQ0FBUCxFQUFEO0NBQ0MsR0FBQSxNQUFELEdBQUE7Q0F0RkYsSUFrRlM7O0NBbEZULENBd0ZvQixDQUFQLENBQWIsQ0FBQyxFQUFZLEVBQUMsQ0FBZDtDQUNFLFNBQUEsWUFBQTtDQUFBO0NBQUEsVUFBQSxpQ0FBQTsyQkFBQTtDQUEwQixDQUFrQixFQUFsQixDQUFLLEVBQUw7O1VBQ3hCO0NBQUEsQ0FBbUIsRUFBbEIsQ0FBRCxFQUFBLENBQUE7Q0FDQSxJQUFBLFVBQU87Q0FGVCxNQURXO0NBeEZiLElBd0ZhOztDQUtBLENBQVMsQ0FBVCxDQUFBLElBQUEsT0FBRTtDQUNiLElBQUEsS0FBQTtDQUFBLEVBRGEsQ0FBQSxFQUFEO0NBQ1osRUFEb0IsQ0FBQSxFQUFELEVBQ25CO0NBQUEsQ0FBQSxDQUFTLENBQVIsQ0FBRCxDQUFBO0FBRUcsQ0FBSCxHQUFHLENBQWUsQ0FBbEIsRUFBQTtDQUNFLEVBQXVCLEtBQXZCLENBQUEsQ0FBVTtDQUNWLEVBQWUsQ0FBQSxDQUFSLEtBQWtCLEtBQW5CO0NBQ0osR0FBQyxDQUFLLEtBQU47Q0FGRixRQUNBO0NBREEsRUFJdUIsS0FBdkIsQ0FBQSxDQUFVO0NBQ1YsRUFBZSxDQUFBLENBQVIsS0FBa0IsS0FBbkI7Q0FDSixHQUFDLENBQUssS0FBTjtDQU5GLFFBS0E7Q0FMQSxDQVFrQyxDQUEzQixDQUFQLEVBQU8sQ0FBQSxDQUFQLEVBQU8sRUFBQTtDQVJQLEVBWWEsQ0FBWixDQUFELENBQWEsRUFBYjtNQWJGLEVBQUE7Q0FlRSxFQUFTLENBQVIsQ0FBRCxHQUFBO1FBbEJTO0NBN0ZiLElBNkZhOztDQTdGYixDQWlIYyxDQUFQLENBQUEsQ0FBUCxFQUFPLEVBQUM7Q0FDTixTQUFBLHVCQUFBOztHQURzQixLQUFWO1FBQ1o7Q0FBQSxFQUFRLENBQUMsQ0FBVCxDQUFBO0FBQ29CLENBQXBCLEdBQUEsQ0FBQSxDQUFBO0NBQUEsSUFBQSxVQUFPO1FBRFA7Q0FBQSxFQUVnQixFQUFoQixDQUFBLENBQU87Q0FGUCxFQUdTLEVBQUssQ0FBZDtDQUVBLEdBQUcsQ0FBTSxDQUFUO0FBQ0UsQ0FBQSxZQUFBLHdDQUFBOzZCQUFBO0NBQ0UsRUFBcUIsQ0FBWixDQUFNLEVBQVAsR0FBUjtDQURGLFFBREY7UUFMQTtDQVNDLENBQW9CLEVBQXBCLENBQWtDLEVBQW5DLENBQVMsS0FBVDtDQTNIRixJQWlITzs7Q0FqSFA7O0NBRHdCLElBQUs7O0NBUi9CLENBdUlBLENBQXFCLEVBQWhCLENBQUw7O0NBdklBLENBeUlBLEdBQUssRUFBTCxHQUFnQjtDQUNmLENBQVEsQ0FBQSxDQUFQLENBQUEsR0FBTyxDQUFDO0NBQ0EsQ0FBZ0IsQ0FBdEIsQ0FBQSxDQUFLLEdBQWlCLEtBQXRCO0NBREgsSUFBUTtDQUFSLENBR1MsQ0FBQSxDQUFSLEVBQUEsR0FBUztDQUNQLFNBQUEsVUFBQTtBQUFBLENBQUE7WUFBQSxDQUFBOzZCQUFBO0NBQUEsQ0FBWSxDQUFaLENBQUMsQ0FBRDtDQUFBO3VCQURNO0NBSFQsSUFHUztDQUhULENBTVcsQ0FBQSxDQUFWLElBQUEsQ0FBVTtDQUNGLENBQWtDLEdBQW5DLEdBQWUsQ0FBcEIsSUFBQTtDQVBILElBTVc7Q0FoSlosR0F5SUE7OztDQVVRLEVBQVUsQ0FBbEIsQ0FBdUIsQ0FBakIsQ0FBTjtJQW5KQTtDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiU3BpbmUgPSBAU3BpbmUgb3IgcmVxdWlyZSgnc3BpbmUnKVxuJCAgICAgPSBTcGluZS4kXG5cbmhhc2hTdHJpcCAgICA9IC9eIyovXG5uYW1lZFBhcmFtICAgPSAvOihbXFx3XFxkXSspL2dcbnNwbGF0UGFyYW0gICA9IC9cXCooW1xcd1xcZF0rKS9nXG5lc2NhcGVSZWdFeHAgPSAvWy1bXFxde30oKSs/LixcXFxcXiR8I1xcc10vZ1xuXG5jbGFzcyBTcGluZS5Sb3V0ZSBleHRlbmRzIFNwaW5lLk1vZHVsZVxuICBAZXh0ZW5kIFNwaW5lLkV2ZW50c1xuXG4gIEBoaXN0b3J5U3VwcG9ydDogd2luZG93Lmhpc3Rvcnk/LnB1c2hTdGF0ZT9cblxuICBAcm91dGVzOiBbXVxuXG4gIEBvcHRpb25zOlxuICAgIHRyaWdnZXI6IHRydWVcbiAgICBoaXN0b3J5OiBmYWxzZVxuICAgIHNoaW06IGZhbHNlXG4gICAgcmVwbGFjZTogZmFsc2VcblxuICBAYWRkOiAocGF0aCwgY2FsbGJhY2spIC0+XG4gICAgaWYgKHR5cGVvZiBwYXRoIGlzICdvYmplY3QnIGFuZCBwYXRoIG5vdCBpbnN0YW5jZW9mIFJlZ0V4cClcbiAgICAgIEBhZGQoa2V5LCB2YWx1ZSkgZm9yIGtleSwgdmFsdWUgb2YgcGF0aFxuICAgIGVsc2VcbiAgICAgIEByb3V0ZXMucHVzaChuZXcgQChwYXRoLCBjYWxsYmFjaykpXG5cbiAgQHNldHVwOiAob3B0aW9ucyA9IHt9KSAtPlxuICAgIEBvcHRpb25zID0gJC5leHRlbmQoe30sIEBvcHRpb25zLCBvcHRpb25zKVxuXG4gICAgaWYgKEBvcHRpb25zLmhpc3RvcnkpXG4gICAgICBAaGlzdG9yeSA9IEBoaXN0b3J5U3VwcG9ydCBhbmQgQG9wdGlvbnMuaGlzdG9yeVxuXG4gICAgcmV0dXJuIGlmIEBvcHRpb25zLnNoaW1cblxuICAgIGlmIEBoaXN0b3J5XG4gICAgICAkKHdpbmRvdykuYmluZCgncG9wc3RhdGUnLCBAY2hhbmdlKVxuICAgIGVsc2VcbiAgICAgICQod2luZG93KS5iaW5kKCdoYXNoY2hhbmdlJywgQGNoYW5nZSlcbiAgICBAY2hhbmdlKClcblxuICBAdW5iaW5kOiAtPlxuICAgIHJldHVybiBpZiBAb3B0aW9ucy5zaGltXG5cbiAgICBpZiBAaGlzdG9yeVxuICAgICAgJCh3aW5kb3cpLnVuYmluZCgncG9wc3RhdGUnLCBAY2hhbmdlKVxuICAgIGVsc2VcbiAgICAgICQod2luZG93KS51bmJpbmQoJ2hhc2hjaGFuZ2UnLCBAY2hhbmdlKVxuXG4gIEBuYXZpZ2F0ZTogKGFyZ3MuLi4pIC0+XG4gICAgb3B0aW9ucyA9IHt9XG5cbiAgICBsYXN0QXJnID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdXG4gICAgaWYgdHlwZW9mIGxhc3RBcmcgaXMgJ29iamVjdCdcbiAgICAgIG9wdGlvbnMgPSBhcmdzLnBvcCgpXG4gICAgZWxzZSBpZiB0eXBlb2YgbGFzdEFyZyBpcyAnYm9vbGVhbidcbiAgICAgIG9wdGlvbnMudHJpZ2dlciA9IGFyZ3MucG9wKClcblxuICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQG9wdGlvbnMsIG9wdGlvbnMpXG5cbiAgICBwYXRoID0gYXJncy5qb2luKCcvJylcbiAgICByZXR1cm4gaWYgQHBhdGggaXMgcGF0aFxuICAgIEBwYXRoID0gcGF0aFxuXG4gICAgQHRyaWdnZXIoJ25hdmlnYXRlJywgQHBhdGgpXG5cbiAgICBAbWF0Y2hSb3V0ZShAcGF0aCwgb3B0aW9ucykgaWYgb3B0aW9ucy50cmlnZ2VyXG5cbiAgICByZXR1cm4gaWYgb3B0aW9ucy5zaGltXG5cbiAgICBpZiBAaGlzdG9yeSBhbmQgb3B0aW9ucy5yZXBsYWNlXG4gICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgZG9jdW1lbnQudGl0bGUsIEBwYXRoKVxuICAgIGVsc2UgaWYgQGhpc3RvcnlcbiAgICAgIGhpc3RvcnkucHVzaFN0YXRlKHt9LCBkb2N1bWVudC50aXRsZSwgQHBhdGgpXG4gICAgZWxzZVxuICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBAcGF0aFxuXG4gICMgUHJpdmF0ZVxuXG4gIEBnZXRQYXRoOiAtPlxuICAgIGlmIEBoaXN0b3J5XG4gICAgICBwYXRoID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lXG4gICAgICBwYXRoID0gJy8nICsgcGF0aCBpZiBwYXRoLnN1YnN0cigwLDEpIGlzbnQgJy8nXG4gICAgZWxzZVxuICAgICAgcGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoXG4gICAgICBwYXRoID0gcGF0aC5yZXBsYWNlKGhhc2hTdHJpcCwgJycpXG4gICAgcGF0aFxuXG4gIEBnZXRIb3N0OiAtPlxuICAgIFwiI3t3aW5kb3cubG9jYXRpb24ucHJvdG9jb2x9Ly8je3dpbmRvdy5sb2NhdGlvbi5ob3N0fVwiXG5cbiAgQGNoYW5nZTogLT5cbiAgICBwYXRoID0gQGdldFBhdGgoKVxuICAgIHJldHVybiBpZiBwYXRoIGlzIEBwYXRoXG4gICAgQHBhdGggPSBwYXRoXG4gICAgQG1hdGNoUm91dGUoQHBhdGgpXG5cbiAgQG1hdGNoUm91dGU6IChwYXRoLCBvcHRpb25zKSAtPlxuICAgIGZvciByb3V0ZSBpbiBAcm91dGVzIHdoZW4gcm91dGUubWF0Y2gocGF0aCwgb3B0aW9ucylcbiAgICAgIEB0cmlnZ2VyKCdjaGFuZ2UnLCByb3V0ZSwgcGF0aClcbiAgICAgIHJldHVybiByb3V0ZVxuXG4gIGNvbnN0cnVjdG9yOiAoQHBhdGgsIEBjYWxsYmFjaykgLT5cbiAgICBAbmFtZXMgPSBbXVxuXG4gICAgaWYgdHlwZW9mIHBhdGggaXMgJ3N0cmluZydcbiAgICAgIG5hbWVkUGFyYW0ubGFzdEluZGV4ID0gMFxuICAgICAgd2hpbGUgKG1hdGNoID0gbmFtZWRQYXJhbS5leGVjKHBhdGgpKSAhPSBudWxsXG4gICAgICAgIEBuYW1lcy5wdXNoKG1hdGNoWzFdKVxuXG4gICAgICBzcGxhdFBhcmFtLmxhc3RJbmRleCA9IDBcbiAgICAgIHdoaWxlIChtYXRjaCA9IHNwbGF0UGFyYW0uZXhlYyhwYXRoKSkgIT0gbnVsbFxuICAgICAgICBAbmFtZXMucHVzaChtYXRjaFsxXSlcblxuICAgICAgcGF0aCA9IHBhdGgucmVwbGFjZShlc2NhcGVSZWdFeHAsICdcXFxcJCYnKVxuICAgICAgICAgICAgICAgICAucmVwbGFjZShuYW1lZFBhcmFtLCAnKFteXFwvXSopJylcbiAgICAgICAgICAgICAgICAgLnJlcGxhY2Uoc3BsYXRQYXJhbSwgJyguKj8pJylcblxuICAgICAgQHJvdXRlID0gbmV3IFJlZ0V4cChcIl4je3BhdGh9JFwiKVxuICAgIGVsc2VcbiAgICAgIEByb3V0ZSA9IHBhdGhcblxuICBtYXRjaDogKHBhdGgsIG9wdGlvbnMgPSB7fSkgLT5cbiAgICBtYXRjaCA9IEByb3V0ZS5leGVjKHBhdGgpXG4gICAgcmV0dXJuIGZhbHNlIHVubGVzcyBtYXRjaFxuICAgIG9wdGlvbnMubWF0Y2ggPSBtYXRjaFxuICAgIHBhcmFtcyA9IG1hdGNoLnNsaWNlKDEpXG5cbiAgICBpZiBAbmFtZXMubGVuZ3RoXG4gICAgICBmb3IgcGFyYW0sIGkgaW4gcGFyYW1zXG4gICAgICAgIG9wdGlvbnNbQG5hbWVzW2ldXSA9IHBhcmFtXG5cbiAgICBAY2FsbGJhY2suY2FsbChudWxsLCBvcHRpb25zKSBpc250IGZhbHNlXG5cbiMgQ29mZmVlLXNjcmlwdCBidWdcblNwaW5lLlJvdXRlLmNoYW5nZSA9IFNwaW5lLlJvdXRlLnByb3h5KFNwaW5lLlJvdXRlLmNoYW5nZSlcblxuU3BpbmUuQ29udHJvbGxlci5pbmNsdWRlXG4gIHJvdXRlOiAocGF0aCwgY2FsbGJhY2spIC0+XG4gICAgU3BpbmUuUm91dGUuYWRkKHBhdGgsIEBwcm94eShjYWxsYmFjaykpXG5cbiAgcm91dGVzOiAocm91dGVzKSAtPlxuICAgIEByb3V0ZShrZXksIHZhbHVlKSBmb3Iga2V5LCB2YWx1ZSBvZiByb3V0ZXNcblxuICBuYXZpZ2F0ZTogLT5cbiAgICBTcGluZS5Sb3V0ZS5uYXZpZ2F0ZS5hcHBseShTcGluZS5Sb3V0ZSwgYXJndW1lbnRzKVxuXG5tb2R1bGU/LmV4cG9ydHMgPSBTcGluZS5Sb3V0ZVxuIl19
// Generated by CoffeeScript 1.6.1
(function() {
  var $, Spine, escapeRegExp, hashStrip, namedParam, splatParam,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __slice = [].slice;

  Spine = this.Spine || require('spine');

  $ = Spine.$;

  hashStrip = /^#*/;

  namedParam = /:([\w\d]+)/g;

  splatParam = /\*([\w\d]+)/g;

  escapeRegExp = /[-[\]{}()+?.,\\^$|#\s]/g;

  Spine.Route = (function(_super) {
    var _ref;

    __extends(Route, _super);

    Route.extend(Spine.Events);

    Route.historySupport = ((_ref = window.history) != null ? _ref.pushState : void 0) != null;

    Route.routes = [];

    Route.options = {
      trigger: true,
      history: false,
      shim: false,
      replace: false
    };

    Route.add = function(path, callback) {
      var key, value, _results;
      if (typeof path === 'object' && !(path instanceof RegExp)) {
        _results = [];
        for (key in path) {
          value = path[key];
          _results.push(this.add(key, value));
        }
        return _results;
      } else {
        return this.routes.push(new this(path, callback));
      }
    };

    Route.setup = function(options) {
      if (options == null) {
        options = {};
      }
      this.options = $.extend({}, this.options, options);
      if (this.options.history) {
        this.history = this.historySupport && this.options.history;
      }
      if (this.options.shim) {
        return;
      }
      if (this.history) {
        $(window).bind('popstate', this.change);
      } else {
        $(window).bind('hashchange', this.change);
      }
      return this.change();
    };

    Route.unbind = function() {
      if (this.options.shim) {
        return;
      }
      if (this.history) {
        return $(window).unbind('popstate', this.change);
      } else {
        return $(window).unbind('hashchange', this.change);
      }
    };

    Route.navigate = function() {
      var args, lastArg, options, path;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      options = {};
      lastArg = args[args.length - 1];
      if (typeof lastArg === 'object') {
        options = args.pop();
      } else if (typeof lastArg === 'boolean') {
        options.trigger = args.pop();
      }
      options = $.extend({}, this.options, options);
      path = args.join('/');
      if (this.path === path) {
        return;
      }
      this.path = path;
      this.trigger('navigate', this.path);
      if (options.trigger) {
        this.matchRoute(this.path, options);
      }
      if (options.shim) {
        return;
      }
      if (this.history && options.replace) {
        return history.replaceState({}, document.title, this.path);
      } else if (this.history) {
        return history.pushState({}, document.title, this.path);
      } else {
        return window.location.hash = this.path;
      }
    };

    Route.getPath = function() {
      var path;
      if (this.history) {
        path = window.location.pathname;
        if (path.substr(0, 1) !== '/') {
          path = '/' + path;
        }
      } else {
        path = window.location.hash;
        path = path.replace(hashStrip, '');
      }
      return path;
    };

    Route.getHost = function() {
      return "" + window.location.protocol + "//" + window.location.host;
    };

    Route.change = function() {
      var path;
      path = this.getPath();
      if (path === this.path) {
        return;
      }
      this.path = path;
      return this.matchRoute(this.path);
    };

    Route.matchRoute = function(path, options) {
      var route, _i, _len, _ref1;
      _ref1 = this.routes;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        route = _ref1[_i];
        if (!(route.match(path, options))) {
          continue;
        }
        this.trigger('change', route, path);
        return route;
      }
    };

    function Route(path, callback) {
      var match;
      this.path = path;
      this.callback = callback;
      this.names = [];
      if (typeof path === 'string') {
        namedParam.lastIndex = 0;
        while ((match = namedParam.exec(path)) !== null) {
          this.names.push(match[1]);
        }
        splatParam.lastIndex = 0;
        while ((match = splatParam.exec(path)) !== null) {
          this.names.push(match[1]);
        }
        path = path.replace(escapeRegExp, '\\$&').replace(namedParam, '([^\/]*)').replace(splatParam, '(.*?)');
        this.route = new RegExp("^" + path + "$");
      } else {
        this.route = path;
      }
    }

    Route.prototype.match = function(path, options) {
      var i, match, param, params, _i, _len;
      if (options == null) {
        options = {};
      }
      match = this.route.exec(path);
      if (!match) {
        return false;
      }
      options.match = match;
      params = match.slice(1);
      if (this.names.length) {
        for (i = _i = 0, _len = params.length; _i < _len; i = ++_i) {
          param = params[i];
          options[this.names[i]] = param;
        }
      }
      return this.callback.call(null, options) !== false;
    };

    return Route;

  })(Spine.Module);

  Spine.Route.change = Spine.Route.proxy(Spine.Route.change);

  Spine.Controller.include({
    route: function(path, callback) {
      return Spine.Route.add(path, this.proxy(callback));
    },
    routes: function(routes) {
      var key, value, _results;
      _results = [];
      for (key in routes) {
        value = routes[key];
        _results.push(this.route(key, value));
      }
      return _results;
    },
    navigate: function() {
      return Spine.Route.navigate.apply(Spine.Route, arguments);
    }
  });

  if (typeof module !== "undefined" && module !== null) {
    module.exports = Spine.Route;
  }

}).call(this);
