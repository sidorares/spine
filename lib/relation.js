//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVsYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvcmVsYXRpb24uY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Q0FBQSxLQUFBLDJFQUFBO0tBQUE7b1NBQUE7Q0FBQTtDQUFBLENBQUEsQ0FBVSxDQUFDLENBQVgsRUFBb0I7O0NBQXBCLENBQ0EsQ0FBVSxFQUFLLEVBQWY7O0NBREEsQ0FFQSxDQUFVLENBQUMsQ0FBWSxFQUF2QixFQUF3QjtDQUFlLEdBQUwsQ0FBQSxNQUFBO0NBQVosRUFBQzs7Q0FGdkIsQ0FJTTtDQUNMO0NBQUE7O0NBQWMsRUFBQSxDQUFBLEdBQUEsYUFBQztDQUNaLFNBQUE7O0dBRHNCLEtBQVY7UUFDWjtBQUFBLENBQUEsVUFBQSxHQUFBOzhCQUFBO0NBQ0UsRUFBRSxDQUFBLENBQUYsR0FBQTtDQURGLE1BRFc7Q0FBZCxJQUFjOztDQUFkLEVBSUMsTUFBSztDQUNILFNBQUEsRUFBQTtDQUFDLEVBQWEsQ0FBYixDQUFLLENBQU4sR0FBZSxJQUFmO0NBQXdCLEVBQUQsRUFBQyxLQUFELEtBQUE7Q0FBdkIsTUFBYztDQUxqQixJQUlNOztDQUpOLEVBT1EsRUFBUCxJQUFPO0NBQ0osRUFBRCxDQUFDLFNBQUQ7Q0FSSCxJQU9ROztDQVBSLEVBVU8sQ0FBTixLQUFNO0NBQ0osS0FBQSxJQUFBO0NBQUEsRUFBUyxDQUFDLEVBQVY7Q0FDTyxFQUFnQixHQUFoQixPQUFQO0NBWkgsSUFVTzs7Q0FWUCxDQWNPLENBQUEsQ0FBTixLQUFPO0NBQ0wsTUFBQSxHQUFBO1NBQUEsR0FBQTtDQUFBLEVBQVUsQ0FBQyxFQUFYLENBQUEsRUFBbUI7Q0FDakIsQ0FBQSxDQUFFLEVBQWEsVUFBZjtDQURRLE1BQVE7QUFFbUYsQ0FBckcsR0FBQSxFQUFBLENBQTZHO0NBQTdHLENBQWlCLENBQUcsQ0FBVixDQUFBLElBQU8sS0FBUCxrQ0FBTztRQUZqQjtDQUdRLE1BQUEsTUFBUjtDQWxCSCxJQWNPOztDQWRQLENBb0I0QixDQUFQLENBQUEsQ0FBQSxJQUFDLFNBQXJCO0NBQ0UsU0FBQSxFQUFBO0NBQUMsRUFBYSxDQUFiLENBQUssQ0FBTixHQUFlLElBQWY7Q0FDRyxFQUFELENBQXFCLENBQXBCLEtBQUQsS0FBQTtDQURGLE1BQWM7Q0FyQmpCLElBb0JxQjs7Q0FwQnJCLENBd0J5QixDQUFQLENBQUEsQ0FBQSxJQUFDLE1BQWxCO0NBQ0csQ0FBeUIsRUFBekIsQ0FBRCxRQUFBLEtBQUE7Q0F6QkgsSUF3QmtCOztDQXhCbEIsQ0EyQlMsQ0FBQSxHQUFSLEdBQVM7Q0FDUCxTQUFBLEVBQUE7Q0FBQyxFQUFhLENBQWIsQ0FBSyxDQUFOLEdBQWUsSUFBZjtDQUNHLENBQW9CLENBQXJCLENBQXFCLENBQXBCLEtBQUQsS0FBQTtDQURGLE1BQWM7Q0E1QmpCLElBMkJTOztDQTNCVCxFQStCVSxHQUFBLENBQVQsRUFBVTtDQUNSLFNBQUEsZ0NBQUE7Q0FBQTtDQUFBLFVBQUEsZ0NBQUE7MkJBQUE7QUFBQSxDQUFBLENBQXNCLEVBQWQsQ0FBSyxDQUFiLENBQXNCLENBQXRCO0NBQUEsTUFBQTtDQUFBLEVBQ1UsQ0FBQyxDQUFLLENBQWhCLENBQUEsQ0FBVTtBQUVpQixDQUEzQixHQUFBLEVBQUEsQ0FBMkI7Q0FBM0IsRUFBVSxJQUFWLENBQUE7UUFIQTtBQUtBLENBQUEsVUFBQSxxQ0FBQTs4QkFBQTtDQUNFLEVBQW1CLEVBQW5CLENBQU0sRUFBTixDQUFBO0NBQUEsQ0FBQSxDQUNnQixDQUFSLEVBQUQsRUFBUDtDQURBLENBRWUsQ0FBYSxDQUEzQixDQUFLLENBQWUsQ0FBTixDQUFmO0NBSEYsTUFMQTtDQVVDLENBQXlCLEVBQXpCLENBQUssRUFBTixFQUFBLENBQTBCLEdBQTFCO0NBMUNILElBK0JVOztDQS9CVixFQTRDUyxHQUFSLEdBQVM7Q0FDUCxDQUFBLENBQWdCLENBQVIsRUFBUjtDQUNDLEdBQUEsQ0FBSyxDQUFOLE9BQUE7Q0E5Q0gsSUE0Q1M7O0NBNUNULEVBa0RhLEdBQUEsR0FBQyxDQUFiO0NBQ1MsR0FBQyxDQUFTLENBQVYsT0FBUDtDQW5ESCxJQWtEYTs7Q0FsRGI7O0NBRHdCLElBQUs7O0NBSjlCLENBMERNO0NBQ0w7Q0FBQTs7Q0FBYyxFQUFBLENBQUEsR0FBQSxXQUFDO0NBQ1osU0FBQTs7R0FEc0IsS0FBVjtRQUNaO0FBQUEsQ0FBQSxVQUFBLEdBQUE7OEJBQUE7Q0FDRSxFQUFFLENBQUEsQ0FBRixHQUFBO0NBREYsTUFEVztDQUFkLElBQWM7O0NBQWQsRUFJUyxHQUFSLEdBQVE7Q0FDTCxHQUFBLENBQXdCLENBQWpCLE9BQVI7Q0FMSCxJQUlTOztDQUpULEVBT1MsRUFBQSxDQUFSLEdBQVM7QUFDUCxDQUFBLEdBQUEsQ0FBTyxDQUFQLE1BQXdCO0NBQ3RCLEVBQVksQ0FBQSxDQUFaLEdBQUE7UUFERjtDQUVBLEdBQWdCLENBQUssQ0FBckI7Q0FBQSxHQUFBLENBQUssR0FBTDtRQUZBO0NBR0MsRUFBZ0IsQ0FBaEIsQ0FBZ0IsQ0FBVCxPQUFSO0NBWEgsSUFPUzs7Q0FQVDs7Q0FEc0IsSUFBSzs7Q0ExRDVCLENBd0VNO0NBQ0w7Q0FBQTs7Q0FBYyxFQUFBLENBQUEsR0FBQSxZQUFDO0NBQ1osU0FBQTs7R0FEc0IsS0FBVjtRQUNaO0FBQUEsQ0FBQSxVQUFBLEdBQUE7OEJBQUE7Q0FDRSxFQUFFLENBQUEsQ0FBRixHQUFBO0NBREYsTUFEVztDQUFkLElBQWM7O0NBQWQsRUFJTyxDQUFOLEtBQU07Q0FDSCxDQUFELEVBQUMsQ0FBb0IsQ0FBZCxPQUFQLEVBQWU7Q0FMbEIsSUFJTzs7Q0FKUCxFQU9TLEVBQUEsQ0FBUixHQUFTO0FBQ1AsQ0FBQSxHQUFBLENBQU8sQ0FBUCxNQUF3QjtDQUN0QixFQUFRLENBQUMsQ0FBVCxHQUFBO1FBREY7Q0FBQSxDQUFBLENBR2UsQ0FBUixDQUFELENBQU47Q0FDTSxHQUFOLENBQUssUUFBTDtDQVpILElBT1M7O0NBUFQ7O0NBRHVCLElBQUs7O0NBeEU3QixDQXVGQSxDQUFjLE1BQUMsRUFBZjtDQUNNLENBQWMsQ0FBZixDQUFILEdBQUEsSUFBQTtDQXhGRixFQXVGYzs7Q0F2RmQsQ0EwRkEsQ0FBYSxNQUFDLENBQWQ7Q0FDTSxDQUFlLENBQWhCLENBQUgsQ0FBQSxFQUFBLElBQUEsUUFBQSxJQUFBO0NBM0ZGLEVBMEZhOztDQTFGYixDQWlHQSxHQUFLLENBQUw7Q0FDQyxDQUFVLENBQUEsQ0FBVCxDQUFTLEVBQVQsRUFBVTtDQUNSLFNBQUEsQ0FBQTs7Q0FBVSxDQUFGLENBQUEsQ0FBaUIsSUFBekIsQ0FBVSxDQUFBO1FBQVY7Q0FBQSxFQUVjLEdBQWQsR0FBZSxFQUFmO0FBQzRCLENBQTFCLEdBQTBCLENBQUEsQ0FBQSxFQUExQjtDQUFBLEVBQVEsRUFBUixFQUFRLEdBQVI7VUFBQTtDQUdDLEdBREcsTUFBQSxLQUFBO0NBQ0gsQ0FBTyxFQUFOLE1BQUE7Q0FBRCxDQUFvQixHQUFQLEtBQUE7Q0FBYixDQUNTLElBQVIsSUFBQTtDQURELENBQ3VCLEVBQU4sTUFBQTtDQUxOLFNBR1I7Q0FMTixNQUVjO0NBUWIsRUFBVyxDQUFYLENBQVcsSUFBUixJQUFKO0NBQ0UsR0FBaUMsSUFBakMsS0FBQTtDQUFBLEdBQUEsQ0FBQSxFQUFBLEdBQUEsQ0FBQTtVQUFBO0NBQ1ksR0FBWixPQUFBLElBQUE7Q0FiSyxNQVdLO0NBWGYsSUFBVTtDQUFWLENBZVksQ0FBQSxDQUFYLENBQVcsSUFBWDtDQUNFLFNBQUEsQ0FBQTs7Q0FBVSxDQUFGLENBQUEsQ0FBRSxJQUFWLEdBQVU7UUFBVjtDQUFBLEVBRWMsR0FBZCxHQUFlLEVBQWY7QUFDNEIsQ0FBMUIsR0FBMEIsQ0FBQSxDQUFBLEVBQTFCO0NBQUEsRUFBUSxFQUFSLEVBQVEsR0FBUjtVQUFBO0NBR0MsR0FERyxJQUFBLE9BQUE7Q0FDSCxDQUFPLEVBQU4sTUFBQTtDQUFELENBQW9CLEdBQVAsS0FBQTtDQUFiLENBQ1MsSUFBUixJQUFBO0NBREQsQ0FDdUIsRUFBTixNQUFBO0NBTE4sU0FHUjtDQUxOLE1BRWM7Q0FGZCxFQVVZLENBQVgsQ0FBVyxDQUFaLEdBQUk7Q0FDRixHQUFnQyxJQUFoQyxLQUFBO0NBQUEsR0FBQSxDQUFBLENBQUEsSUFBQSxDQUFBO1VBQUE7Q0FDWSxHQUFaLEVBQUEsS0FBQSxJQUFBO0NBWkYsTUFVWTtDQUlYLEdBQUEsTUFBVSxHQUFYO0NBOUJILElBZVk7Q0FmWixDQWdDUyxDQUFBLENBQVIsQ0FBUSxDQUFSLEdBQVM7Q0FDUCxTQUFBLENBQUE7O0NBQVUsQ0FBRixDQUFBLENBQWMsSUFBdEIsQ0FBVSxDQUFBO1FBQVY7Q0FBQSxFQUVjLEdBQWQsR0FBZSxFQUFmO0FBQzRCLENBQTFCLEdBQTBCLENBQUEsQ0FBQSxFQUExQjtDQUFBLEVBQVEsRUFBUixFQUFRLEdBQVI7VUFBQTtDQUdDLEdBREcsS0FBQSxNQUFBO0NBQ0gsQ0FBTyxFQUFOLE1BQUE7Q0FBRCxDQUFvQixHQUFQLEtBQUE7Q0FBYixDQUNTLElBQVIsSUFBQTtDQURELENBQ3VCLEVBQU4sTUFBQTtDQUxOLFNBR1I7Q0FMTixNQUVjO0NBUWIsRUFBVyxDQUFYLENBQVcsSUFBUixJQUFKO0NBQ0UsR0FBZ0MsSUFBaEMsS0FBQTtDQUFBLEdBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBQTtVQUFBO0NBQ1ksR0FBWixPQUFBLElBQUE7Q0FiSSxNQVdNO0NBM0NmLElBZ0NTO0NBbElWLEdBaUdBOztDQWpHQSxDQWlKQSxDQUFtQixFQUFkLEtBQUw7O0NBakpBLENBa0pBLENBQWtCLEVBQWIsSUFBTDs7Q0FsSkEsQ0FtSkEsQ0FBaUIsRUFBWixHQUFMO0NBbkpBIiwic291cmNlc0NvbnRlbnQiOlsiU3BpbmUgICA9IEBTcGluZSBvciByZXF1aXJlKCdzcGluZScpXG5pc0FycmF5ID0gU3BpbmUuaXNBcnJheVxucmVxdWlyZSA9IEByZXF1aXJlIG9yICgodmFsdWUpIC0+IGV2YWwodmFsdWUpKVxuXG5jbGFzcyBDb2xsZWN0aW9uIGV4dGVuZHMgU3BpbmUuTW9kdWxlXG4gIGNvbnN0cnVjdG9yOiAob3B0aW9ucyA9IHt9KSAtPlxuICAgIGZvciBrZXksIHZhbHVlIG9mIG9wdGlvbnNcbiAgICAgIEBba2V5XSA9IHZhbHVlXG5cbiAgYWxsOiAtPlxuICAgIEBtb2RlbC5zZWxlY3QgKHJlYykgPT4gQGFzc29jaWF0ZWQocmVjKVxuXG4gIGZpcnN0OiAtPlxuICAgIEBhbGwoKVswXVxuXG4gIGxhc3Q6IC0+XG4gICAgdmFsdWVzID0gQGFsbCgpXG4gICAgdmFsdWVzW3ZhbHVlcy5sZW5ndGggLSAxXVxuXG4gIGZpbmQ6IChpZCkgLT5cbiAgICByZWNvcmRzID0gQHNlbGVjdCAocmVjKSA9PlxuICAgICAgXCIje3JlYy5pZH1cIiBpcyBcIiN7aWR9XCJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJcXFwiI3tAbW9kZWwuY2xhc3NOYW1lfVxcXCIgbW9kZWwgY291bGQgbm90IGZpbmQgYSByZWNvcmQgZm9yIHRoZSBJRCBcXFwiI3tpZH1cXFwiXCIpIHVubGVzcyByZWNvcmRzWzBdXG4gICAgcmVjb3Jkc1swXVxuXG4gIGZpbmRBbGxCeUF0dHJpYnV0ZTogKG5hbWUsIHZhbHVlKSAtPlxuICAgIEBtb2RlbC5zZWxlY3QgKHJlYykgPT5cbiAgICAgIEBhc3NvY2lhdGVkKHJlYykgYW5kIHJlY1tuYW1lXSBpcyB2YWx1ZVxuXG4gIGZpbmRCeUF0dHJpYnV0ZTogKG5hbWUsIHZhbHVlKSAtPlxuICAgIEBmaW5kQWxsQnlBdHRyaWJ1dGUobmFtZSwgdmFsdWUpWzBdXG5cbiAgc2VsZWN0OiAoY2IpIC0+XG4gICAgQG1vZGVsLnNlbGVjdCAocmVjKSA9PlxuICAgICAgQGFzc29jaWF0ZWQocmVjKSBhbmQgY2IocmVjKVxuXG4gIHJlZnJlc2g6ICh2YWx1ZXMpIC0+XG4gICAgZGVsZXRlIEBtb2RlbC5yZWNvcmRzW3JlY29yZC5pZF0gZm9yIHJlY29yZCBpbiBAYWxsKClcbiAgICByZWNvcmRzID0gQG1vZGVsLmZyb21KU09OKHZhbHVlcylcblxuICAgIHJlY29yZHMgPSBbcmVjb3Jkc10gdW5sZXNzIGlzQXJyYXkocmVjb3JkcylcblxuICAgIGZvciByZWNvcmQgaW4gcmVjb3Jkc1xuICAgICAgcmVjb3JkLm5ld1JlY29yZCA9IGZhbHNlXG4gICAgICByZWNvcmRbQGZrZXldID0gQHJlY29yZC5pZFxuICAgICAgQG1vZGVsLnJlY29yZHNbcmVjb3JkLmlkXSA9IHJlY29yZFxuXG4gICAgQG1vZGVsLnRyaWdnZXIoJ3JlZnJlc2gnLCBAbW9kZWwuY2xvbmVBcnJheShyZWNvcmRzKSlcblxuICBjcmVhdGU6IChyZWNvcmQpIC0+XG4gICAgcmVjb3JkW0Bma2V5XSA9IEByZWNvcmQuaWRcbiAgICBAbW9kZWwuY3JlYXRlKHJlY29yZClcblxuICAjIFByaXZhdGVcblxuICBhc3NvY2lhdGVkOiAocmVjb3JkKSAtPlxuICAgIHJlY29yZFtAZmtleV0gaXMgQHJlY29yZC5pZFxuXG5jbGFzcyBJbnN0YW5jZSBleHRlbmRzIFNwaW5lLk1vZHVsZVxuICBjb25zdHJ1Y3RvcjogKG9wdGlvbnMgPSB7fSkgLT5cbiAgICBmb3Iga2V5LCB2YWx1ZSBvZiBvcHRpb25zXG4gICAgICBAW2tleV0gPSB2YWx1ZVxuXG4gIGV4aXN0czogLT5cbiAgICBAcmVjb3JkW0Bma2V5XSBhbmQgQG1vZGVsLmV4aXN0cyhAcmVjb3JkW0Bma2V5XSlcblxuICB1cGRhdGU6ICh2YWx1ZSkgLT5cbiAgICB1bmxlc3MgdmFsdWUgaW5zdGFuY2VvZiBAbW9kZWxcbiAgICAgIHZhbHVlID0gbmV3IEBtb2RlbCh2YWx1ZSlcbiAgICB2YWx1ZS5zYXZlKCkgaWYgdmFsdWUuaXNOZXcoKVxuICAgIEByZWNvcmRbQGZrZXldID0gdmFsdWUgYW5kIHZhbHVlLmlkXG5cbmNsYXNzIFNpbmdsZXRvbiBleHRlbmRzIFNwaW5lLk1vZHVsZVxuICBjb25zdHJ1Y3RvcjogKG9wdGlvbnMgPSB7fSkgLT5cbiAgICBmb3Iga2V5LCB2YWx1ZSBvZiBvcHRpb25zXG4gICAgICBAW2tleV0gPSB2YWx1ZVxuXG4gIGZpbmQ6IC0+XG4gICAgQHJlY29yZC5pZCBhbmQgQG1vZGVsLmZpbmRCeUF0dHJpYnV0ZShAZmtleSwgQHJlY29yZC5pZClcblxuICB1cGRhdGU6ICh2YWx1ZSkgLT5cbiAgICB1bmxlc3MgdmFsdWUgaW5zdGFuY2VvZiBAbW9kZWxcbiAgICAgIHZhbHVlID0gQG1vZGVsLmZyb21KU09OKHZhbHVlKVxuXG4gICAgdmFsdWVbQGZrZXldID0gQHJlY29yZC5pZFxuICAgIHZhbHVlLnNhdmUoKVxuXG5zaW5ndWxhcml6ZSA9IChzdHIpIC0+XG4gIHN0ci5yZXBsYWNlKC9zJC8sICcnKVxuXG51bmRlcnNjb3JlID0gKHN0cikgLT5cbiAgc3RyLnJlcGxhY2UoLzo6L2csICcvJylcbiAgICAgLnJlcGxhY2UoLyhbQS1aXSspKFtBLVpdW2Etel0pL2csICckMV8kMicpXG4gICAgIC5yZXBsYWNlKC8oW2EtelxcZF0pKFtBLVpdKS9nLCAnJDFfJDInKVxuICAgICAucmVwbGFjZSgvLS9nLCAnXycpXG4gICAgIC50b0xvd2VyQ2FzZSgpXG5cblNwaW5lLk1vZGVsLmV4dGVuZFxuICBoYXNNYW55OiAobmFtZSwgbW9kZWwsIGZrZXkpIC0+XG4gICAgZmtleSA/PSBcIiN7dW5kZXJzY29yZSh0aGlzLmNsYXNzTmFtZSl9X2lkXCJcblxuICAgIGFzc29jaWF0aW9uID0gKHJlY29yZCkgLT5cbiAgICAgIG1vZGVsID0gcmVxdWlyZShtb2RlbCkgaWYgdHlwZW9mIG1vZGVsIGlzICdzdHJpbmcnXG5cbiAgICAgIG5ldyBDb2xsZWN0aW9uKFxuICAgICAgICBuYW1lOiBuYW1lLCBtb2RlbDogbW9kZWwsXG4gICAgICAgIHJlY29yZDogcmVjb3JkLCBma2V5OiBma2V5XG4gICAgICApXG5cbiAgICBAOjpbbmFtZV0gPSAodmFsdWUpIC0+XG4gICAgICBhc3NvY2lhdGlvbihAKS5yZWZyZXNoKHZhbHVlKSBpZiB2YWx1ZT9cbiAgICAgIGFzc29jaWF0aW9uKEApXG5cbiAgYmVsb25nc1RvOiAobmFtZSwgbW9kZWwsIGZrZXkpIC0+XG4gICAgZmtleSA/PSBcIiN7c2luZ3VsYXJpemUobmFtZSl9X2lkXCJcblxuICAgIGFzc29jaWF0aW9uID0gKHJlY29yZCkgLT5cbiAgICAgIG1vZGVsID0gcmVxdWlyZShtb2RlbCkgaWYgdHlwZW9mIG1vZGVsIGlzICdzdHJpbmcnXG5cbiAgICAgIG5ldyBJbnN0YW5jZShcbiAgICAgICAgbmFtZTogbmFtZSwgbW9kZWw6IG1vZGVsLFxuICAgICAgICByZWNvcmQ6IHJlY29yZCwgZmtleTogZmtleVxuICAgICAgKVxuXG4gICAgQDo6W25hbWVdID0gKHZhbHVlKSAtPlxuICAgICAgYXNzb2NpYXRpb24oQCkudXBkYXRlKHZhbHVlKSBpZiB2YWx1ZT9cbiAgICAgIGFzc29jaWF0aW9uKEApLmV4aXN0cygpXG5cbiAgICBAYXR0cmlidXRlcy5wdXNoKGZrZXkpXG5cbiAgaGFzT25lOiAobmFtZSwgbW9kZWwsIGZrZXkpIC0+XG4gICAgZmtleSA/PSBcIiN7dW5kZXJzY29yZShAY2xhc3NOYW1lKX1faWRcIlxuXG4gICAgYXNzb2NpYXRpb24gPSAocmVjb3JkKSAtPlxuICAgICAgbW9kZWwgPSByZXF1aXJlKG1vZGVsKSBpZiB0eXBlb2YgbW9kZWwgaXMgJ3N0cmluZydcblxuICAgICAgbmV3IFNpbmdsZXRvbihcbiAgICAgICAgbmFtZTogbmFtZSwgbW9kZWw6IG1vZGVsLFxuICAgICAgICByZWNvcmQ6IHJlY29yZCwgZmtleTogZmtleVxuICAgICAgKVxuXG4gICAgQDo6W25hbWVdID0gKHZhbHVlKSAtPlxuICAgICAgYXNzb2NpYXRpb24oQCkudXBkYXRlKHZhbHVlKSBpZiB2YWx1ZT9cbiAgICAgIGFzc29jaWF0aW9uKEApLmZpbmQoKVxuXHQgIFxuU3BpbmUuQ29sbGVjdGlvbiA9IENvbGxlY3Rpb25cblNwaW5lLlNpbmdsZXRvbiA9IFNpbmdsZXRvblxuU3BpbmUuSW5zdGFuY2UgPSBJbnN0YW5jZVxuIl19
// Generated by CoffeeScript 1.6.1
(function() {
  var Collection, Instance, Singleton, Spine, isArray, require, singularize, underscore,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  Spine = this.Spine || require('spine');

  isArray = Spine.isArray;

  require = this.require || (function(value) {
    return eval(value);
  });

  Collection = (function(_super) {

    __extends(Collection, _super);

    function Collection(options) {
      var key, value;
      if (options == null) {
        options = {};
      }
      for (key in options) {
        value = options[key];
        this[key] = value;
      }
    }

    Collection.prototype.all = function() {
      var _this = this;
      return this.model.select(function(rec) {
        return _this.associated(rec);
      });
    };

    Collection.prototype.first = function() {
      return this.all()[0];
    };

    Collection.prototype.last = function() {
      var values;
      values = this.all();
      return values[values.length - 1];
    };

    Collection.prototype.find = function(id) {
      var records,
        _this = this;
      records = this.select(function(rec) {
        return ("" + rec.id) === ("" + id);
      });
      if (!records[0]) {
        throw new Error("\"" + this.model.className + "\" model could not find a record for the ID \"" + id + "\"");
      }
      return records[0];
    };

    Collection.prototype.findAllByAttribute = function(name, value) {
      var _this = this;
      return this.model.select(function(rec) {
        return _this.associated(rec) && rec[name] === value;
      });
    };

    Collection.prototype.findByAttribute = function(name, value) {
      return this.findAllByAttribute(name, value)[0];
    };

    Collection.prototype.select = function(cb) {
      var _this = this;
      return this.model.select(function(rec) {
        return _this.associated(rec) && cb(rec);
      });
    };

    Collection.prototype.refresh = function(values) {
      var record, records, _i, _j, _len, _len1, _ref;
      _ref = this.all();
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        record = _ref[_i];
        delete this.model.records[record.id];
      }
      records = this.model.fromJSON(values);
      if (!isArray(records)) {
        records = [records];
      }
      for (_j = 0, _len1 = records.length; _j < _len1; _j++) {
        record = records[_j];
        record.newRecord = false;
        record[this.fkey] = this.record.id;
        this.model.records[record.id] = record;
      }
      return this.model.trigger('refresh', this.model.cloneArray(records));
    };

    Collection.prototype.create = function(record) {
      record[this.fkey] = this.record.id;
      return this.model.create(record);
    };

    Collection.prototype.associated = function(record) {
      return record[this.fkey] === this.record.id;
    };

    return Collection;

  })(Spine.Module);

  Instance = (function(_super) {

    __extends(Instance, _super);

    function Instance(options) {
      var key, value;
      if (options == null) {
        options = {};
      }
      for (key in options) {
        value = options[key];
        this[key] = value;
      }
    }

    Instance.prototype.exists = function() {
      return this.record[this.fkey] && this.model.exists(this.record[this.fkey]);
    };

    Instance.prototype.update = function(value) {
      if (!(value instanceof this.model)) {
        value = new this.model(value);
      }
      if (value.isNew()) {
        value.save();
      }
      return this.record[this.fkey] = value && value.id;
    };

    return Instance;

  })(Spine.Module);

  Singleton = (function(_super) {

    __extends(Singleton, _super);

    function Singleton(options) {
      var key, value;
      if (options == null) {
        options = {};
      }
      for (key in options) {
        value = options[key];
        this[key] = value;
      }
    }

    Singleton.prototype.find = function() {
      return this.record.id && this.model.findByAttribute(this.fkey, this.record.id);
    };

    Singleton.prototype.update = function(value) {
      if (!(value instanceof this.model)) {
        value = this.model.fromJSON(value);
      }
      value[this.fkey] = this.record.id;
      return value.save();
    };

    return Singleton;

  })(Spine.Module);

  singularize = function(str) {
    return str.replace(/s$/, '');
  };

  underscore = function(str) {
    return str.replace(/::/g, '/').replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2').replace(/([a-z\d])([A-Z])/g, '$1_$2').replace(/-/g, '_').toLowerCase();
  };

  Spine.Model.extend({
    hasMany: function(name, model, fkey) {
      var association;
      if (fkey == null) {
        fkey = "" + (underscore(this.className)) + "_id";
      }
      association = function(record) {
        if (typeof model === 'string') {
          model = require(model);
        }
        return new Collection({
          name: name,
          model: model,
          record: record,
          fkey: fkey
        });
      };
      return this.prototype[name] = function(value) {
        if (value != null) {
          association(this).refresh(value);
        }
        return association(this);
      };
    },
    belongsTo: function(name, model, fkey) {
      var association;
      if (fkey == null) {
        fkey = "" + (singularize(name)) + "_id";
      }
      association = function(record) {
        if (typeof model === 'string') {
          model = require(model);
        }
        return new Instance({
          name: name,
          model: model,
          record: record,
          fkey: fkey
        });
      };
      this.prototype[name] = function(value) {
        if (value != null) {
          association(this).update(value);
        }
        return association(this).exists();
      };
      return this.attributes.push(fkey);
    },
    hasOne: function(name, model, fkey) {
      var association;
      if (fkey == null) {
        fkey = "" + (underscore(this.className)) + "_id";
      }
      association = function(record) {
        if (typeof model === 'string') {
          model = require(model);
        }
        return new Singleton({
          name: name,
          model: model,
          record: record,
          fkey: fkey
        });
      };
      return this.prototype[name] = function(value) {
        if (value != null) {
          association(this).update(value);
        }
        return association(this).find();
      };
    }
  });

  Spine.Collection = Collection;

  Spine.Singleton = Singleton;

  Spine.Instance = Instance;

}).call(this);
