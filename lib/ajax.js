//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWpheC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9hamF4LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBO0NBQUEsS0FBQSxvRUFBQTtLQUFBOzs7dUJBQUE7Q0FBQTtDQUFBLENBQUEsQ0FBUyxDQUFDLENBQVYsRUFBbUI7O0NBQW5CLENBQ0EsQ0FBUyxFQUFLOztDQURkLENBRUEsQ0FBUyxFQUFUOztDQUZBLENBR0EsQ0FBUyxFQUFUOztDQUhBLENBS0EsQ0FDQyxDQUREO0NBQ0MsQ0FBUyxDQUFBLENBQVIsRUFBQSxHQUFTO0NBQ1csRUFBUCxDQUFpQixFQUE1QixPQUFBO0NBREgsSUFBUztDQUFULENBR1UsRUFBVCxHQUFBO0NBSEQsQ0FLVSxDQUFBLENBQVQsR0FBQSxDQUFTLENBQUM7Q0FDUixHQUFHLEVBQUgsQ0FBQTtDQUNFLEVBQVcsQ0FBVixDQUFELEVBQUEsQ0FBQTtDQUNBO0NBQ0UsT0FBQSxTQUFHO0NBREwsT0FFTSxFQUZOO0NBR0UsZUFBTTtVQUhSO0NBS0UsRUFBVyxDQUFWLEdBQUQsR0FBQTtVQVBKO01BQUEsRUFBQTtDQVNFLE9BQUEsT0FBRztRQVZFO0NBTFYsSUFLVTtDQUxWLENBaUJRLENBQUEsQ0FBUCxDQUFBLEVBQU8sRUFBQztDQUNOLEdBQUcsRUFBSCxDQUFBO0NBQXNCLElBQUQsRUFBTCxRQUFBO01BQWhCLEVBQUE7Q0FBZ0QsSUFBRCxVQUFMO1FBRHJDO0NBakJSLElBaUJRO0NBakJSLENBb0JhLENBQUEsQ0FBWixLQUFZLENBQVo7Q0FDRyxDQUFELEVBQUMsQ0FBRCxRQUFBO0NBckJILElBb0JhO0NBMUJkLEdBQUE7O0NBQUEsQ0E2Qk07Q0FDTDtDQUFBOztDQUFBLEVBQ0UsS0FERDtDQUNDLENBQWMsSUFBYixLQUFBLE9BQUQ7Q0FBQSxDQUNXLElBQVYsRUFBQTtDQURELENBRWMsR0FGZCxDQUVDLEtBQUE7Q0FGRCxDQUdVLElBQVQsQ0FBQTtDQUFTLENBQXFCLE1BQXBCLFFB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Q0FsTmQsR0FBQTs7Q0FBQSxDQXNOQSxDQUNDLENBRFMsQ0FBTCxFQUFMO0NBQ0MsQ0FBVyxDQUFBLENBQVYsSUFBQSxDQUFVO0NBQ1IsR0FBQyxFQUFEO0NBQ0MsR0FBQSxHQUFELE1BQUE7Q0FGSCxJQUFXO0NBdk5aLEdBQUE7O0NBQUEsQ0E0TkEsQ0FBa0IsQ0FBZCxJQUFKLENBQXdCOztDQTVOeEIsQ0E2TkEsQ0FBa0IsQ0FBbEIsQ0FBSzs7O0NBQ0csRUFBVSxDQUFsQixFQUFNLENBQU47SUE5TkE7Q0FBQSIsInNvdXJjZXNDb250ZW50IjpbIlNwaW5lICA9IEBTcGluZSBvciByZXF1aXJlKCdzcGluZScpXG4kICAgICAgPSBTcGluZS4kXG5Nb2RlbCAgPSBTcGluZS5Nb2RlbFxuUXVldWUgID0gJCh7fSlcblxuQWpheCA9XG4gIGdldFVSTDogKG9iamVjdCkgLT5cbiAgICBvYmplY3QgYW5kIG9iamVjdC51cmw/KCkgb3Igb2JqZWN0LnVybFxuXG4gIGVuYWJsZWQ6IHRydWVcblxuICBkaXNhYmxlOiAoY2FsbGJhY2spIC0+XG4gICAgaWYgQGVuYWJsZWRcbiAgICAgIEBlbmFibGVkID0gZmFsc2VcbiAgICAgIHRyeVxuICAgICAgICBkbyBjYWxsYmFja1xuICAgICAgY2F0Y2ggZVxuICAgICAgICB0aHJvdyBlXG4gICAgICBmaW5hbGx5XG4gICAgICAgIEBlbmFibGVkID0gdHJ1ZVxuICAgIGVsc2VcbiAgICAgIGRvIGNhbGxiYWNrXG5cbiAgcXVldWU6IChyZXF1ZXN0KSAtPlxuICAgIGlmIHJlcXVlc3QgdGhlbiBRdWV1ZS5xdWV1ZShyZXF1ZXN0KSBlbHNlIFF1ZXVlLnF1ZXVlKClcblxuICBjbGVhclF1ZXVlOiAtPlxuICAgIEBxdWV1ZSBbXVxuXG5jbGFzcyBCYXNlXG4gIGRlZmF1bHRzOlxuICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbidcbiAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgcHJvY2Vzc0RhdGE6IGZhbHNlXG4gICAgaGVhZGVyczogeydYLVJlcXVlc3RlZC1XaXRoJzogJ1hNTEh0dHBSZXF1ZXN0J31cblxuICBxdWV1ZTogQWpheC5xdWV1ZVxuXG4gIGFqYXg6IChwYXJhbXMsIGRlZmF1bHRzKSAtPlxuICAgICQuYWpheCBAYWpheFNldHRpbmdzKHBhcmFtcywgZGVmYXVsdHMpXG5cbiAgYWpheFF1ZXVlOiAocGFyYW1zLCBkZWZhdWx0cykgLT5cbiAgICBqcVhIUiAgICA9IG51bGxcbiAgICBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKVxuXG4gICAgcHJvbWlzZSAgPSBkZWZlcnJlZC5wcm9taXNlKClcbiAgICByZXR1cm4gcHJvbWlzZSB1bmxlc3MgQWpheC5lbmFibGVkXG5cbiAgICBzZXR0aW5ncyA9IEBhamF4U2V0dGluZ3MocGFyYW1zLCBkZWZhdWx0cylcblxuICAgIHJlcXVlc3QgPSAobmV4dCkgLT5cbiAgICAgIGpxWEhSID0gJC5hamF4KHNldHRpbmdzKVxuICAgICAgICAgICAgICAgIC5kb25lKGRlZmVycmVkLnJlc29sdmUpXG4gICAgICAgICAgICAgICAgLmZhaWwoZGVmZXJyZWQucmVqZWN0KVxuICAgICAgICAgICAgICAgIC50aGVuKG5leHQsIG5leHQpXG5cbiAgICBwcm9taXNlLmFib3J0ID0gKHN0YXR1c1RleHQpIC0+XG4gICAgICByZXR1cm4ganFYSFIuYWJvcnQoc3RhdHVzVGV4dCkgaWYganFYSFJcbiAgICAgIGluZGV4ID0gJC5pbkFycmF5KHJlcXVlc3QsIEBxdWV1ZSgpKVxuICAgICAgQHF1ZXVlKCkuc3BsaWNlKGluZGV4LCAxKSBpZiBpbmRleCA+IC0xXG5cbiAgICAgIGRlZmVycmVkLnJlamVjdFdpdGgoXG4gICAgICAgIHNldHRpbmdzLmNvbnRleHQgb3Igc2V0dGluZ3MsXG4gICAgICAgIFtwcm9taXNlLCBzdGF0dXNUZXh0LCAnJ11cbiAgICAgIClcbiAgICAgIHByb21pc2VcblxuICAgIEBxdWV1ZSByZXF1ZXN0XG4gICAgcHJvbWlzZVxuXG4gIGFqYXhTZXR0aW5nczogKHBhcmFtcywgZGVmYXVsdHMpIC0+XG4gICAgJC5leHRlbmQoe30sIEBkZWZhdWx0cywgZGVmYXVsdHMsIHBhcmFtcylcblxuY2xhc3MgQ29sbGVjdGlvbiBleHRlbmRzIEJhc2VcbiAgY29uc3RydWN0b3I6IChAbW9kZWwpIC0+XG5cbiAgZmluZDogKGlkLCBwYXJhbXMpIC0+XG4gICAgcmVjb3JkID0gbmV3IEBtb2RlbChpZDogaWQpXG4gICAgQGFqYXhRdWV1ZShcbiAgICAgIHBhcmFtcyxcbiAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgdXJsOiAgQWpheC5nZXRVUkwocmVjb3JkKVxuICAgICkuZG9uZShAcmVjb3Jkc1Jlc3BvbnNlKVxuICAgICAuZmFpbChAZmFpbFJlc3BvbnNlKVxuXG4gIGFsbDogKHBhcmFtcykgLT5cbiAgICBAYWpheFF1ZXVlKFxuICAgICAgcGFyYW1zLFxuICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICB1cmw6ICBBamF4LmdldFVSTChAbW9kZWwpXG4gICAgKS5kb25lKEByZWNvcmRzUmVzcG9uc2UpXG4gICAgIC5mYWlsKEBmYWlsUmVzcG9uc2UpXG5cbiAgZmV0Y2g6IChwYXJhbXMgPSB7fSwgb3B0aW9ucyA9IHt9KSAtPlxuICAgIGlmIGlkID0gcGFyYW1zLmlkXG4gICAgICBkZWxldGUgcGFyYW1zLmlkXG4gICAgICBAZmluZChpZCwgcGFyYW1zKS5kb25lIChyZWNvcmQpID0+XG4gICAgICAgIEBtb2RlbC5yZWZyZXNoKHJlY29yZCwgb3B0aW9ucylcbiAgICBlbHNlXG4gICAgICBAYWxsKHBhcmFtcykuZG9uZSAocmVjb3JkcykgPT5cbiAgICAgICAgQG1vZGVsLnJlZnJlc2gocmVjb3Jkcywgb3B0aW9ucylcblxuICAjIFByaXZhdGVcblxuICByZWNvcmRzUmVzcG9uc2U6IChkYXRhLCBzdGF0dXMsIHhocikgPT5cbiAgICBAbW9kZWwudHJpZ2dlcignYWpheFN1Y2Nlc3MnLCBudWxsLCBzdGF0dXMsIHhocilcblxuICBmYWlsUmVzcG9uc2U6ICh4aHIsIHN0YXR1c1RleHQsIGVycm9yKSA9PlxuICAgIEBtb2RlbC50cmlnZ2VyKCdhamF4RXJyb3InLCBudWxsLCB4aHIsIHN0YXR1c1RleHQsIGVycm9yKVxuXG5jbGFzcyBTaW5nbGV0b24gZXh0ZW5kcyBCYXNlXG4gIGNvbnN0cnVjdG9yOiAoQHJlY29yZCkgLT5cbiAgICBAbW9kZWwgPSBAcmVjb3JkLmNvbnN0cnVjdG9yXG5cbiAgcmVsb2FkOiAocGFyYW1zLCBvcHRpb25zKSAtPlxuICAgIEBhamF4UXVldWUoXG4gICAgICBwYXJhbXMsXG4gICAgICB0eXBlOiAnR0VUJ1xuICAgICAgdXJsOiAgQWpheC5nZXRVUkwoQHJlY29yZClcbiAgICApLmRvbmUoQHJlY29yZFJlc3BvbnNlKG9wdGlvbnMpKVxuICAgICAuZmFpbChAZmFpbFJlc3BvbnNlKG9wdGlvbnMpKVxuXG4gIGNyZWF0ZTogKHBhcmFtcywgb3B0aW9ucykgLT5cbiAgICBAYWpheFF1ZXVlKFxuICAgICAgcGFyYW1zLFxuICAgICAgdHlwZTogJ1BPU1QnXG4gICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShAcmVjb3JkKVxuICAgICAgdXJsOiAgQWpheC5nZXRVUkwoQG1vZGVsKVxuICAgICkuZG9uZShAcmVjb3JkUmVzcG9uc2Uob3B0aW9ucykpXG4gICAgIC5mYWlsKEBmYWlsUmVzcG9uc2Uob3B0aW9ucykpXG5cbiAgdXBkYXRlOiAocGFyYW1zLCBvcHRpb25zKSAtPlxuICAgIEBhamF4UXVldWUoXG4gICAgICBwYXJhbXMsXG4gICAgICB0eXBlOiAnUFVUJ1xuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoQHJlY29yZClcbiAgICAgIHVybDogIEFqYXguZ2V0VVJMKEByZWNvcmQpXG4gICAgKS5kb25lKEByZWNvcmRSZXNwb25zZShvcHRpb25zKSlcbiAgICAgLmZhaWwoQGZhaWxSZXNwb25zZShvcHRpb25zKSlcblxuICBkZXN0cm95OiAocGFyYW1zLCBvcHRpb25zKSAtPlxuICAgIEBhamF4UXVldWUoXG4gICAgICBwYXJhbXMsXG4gICAgICB0eXBlOiAnREVMRVRFJ1xuICAgICAgdXJsOiAgQWpheC5nZXRVUkwoQHJlY29yZClcbiAgICApLmRvbmUoQHJlY29yZFJlc3BvbnNlKG9wdGlvbnMpKVxuICAgICAuZmFpbChAZmFpbFJlc3BvbnNlKG9wdGlvbnMpKVxuXG4gICMgUHJpdmF0ZVxuXG4gIHJlY29yZFJlc3BvbnNlOiAob3B0aW9ucyA9IHt9KSA9PlxuICAgIChkYXRhLCBzdGF0dXMsIHhocikgPT5cbiAgICAgIGlmIFNwaW5lLmlzQmxhbmsoZGF0YSkgb3IgQHJlY29yZC5kZXN0cm95ZWRcbiAgICAgICAgZGF0YSA9IGZhbHNlXG4gICAgICBlbHNlXG4gICAgICAgIGRhdGEgPSBAbW9kZWwuZnJvbUpTT04oZGF0YSlcblxuICAgICAgQWpheC5kaXNhYmxlID0+XG4gICAgICAgIGlmIGRhdGFcbiAgICAgICAgICAjIElEIGNoYW5nZSwgbmVlZCB0byBkbyBzb21lIHNoaWZ0aW5nXG4gICAgICAgICAgaWYgZGF0YS5pZCBhbmQgQHJlY29yZC5pZCBpc250IGRhdGEuaWRcbiAgICAgICAgICAgIEByZWNvcmQuY2hhbmdlSUQoZGF0YS5pZClcblxuICAgICAgICAgICMgVXBkYXRlIHdpdGggbGF0ZXN0IGRhdGFcbiAgICAgICAgICBAcmVjb3JkLnVwZGF0ZUF0dHJpYnV0ZXMoZGF0YS5hdHRyaWJ1dGVzKCkpXG5cbiAgICAgIEByZWNvcmQudHJpZ2dlcignYWpheFN1Y2Nlc3MnLCBkYXRhLCBzdGF0dXMsIHhocilcbiAgICAgIG9wdGlvbnMuc3VjY2Vzcz8uYXBwbHkoQHJlY29yZCkgIyBEZXByZWNhdGVkXG4gICAgICBvcHRpb25zLmRvbmU/LmFwcGx5KEByZWNvcmQpXG5cbiAgZmFpbFJlc3BvbnNlOiAob3B0aW9ucyA9IHt9KSA9PlxuICAgICh4aHIsIHN0YXR1c1RleHQsIGVycm9yKSA9PlxuICAgICAgQHJlY29yZC50cmlnZ2VyKCdhamF4RXJyb3InLCB4aHIsIHN0YXR1c1RleHQsIGVycm9yKVxuICAgICAgb3B0aW9ucy5lcnJvcj8uYXBwbHkoQHJlY29yZCkgIyBEZXByZWNhdGVkXG4gICAgICBvcHRpb25zLmZhaWw/LmFwcGx5KEByZWNvcmQpXG5cbiMgQWpheCBlbmRwb2ludFxuTW9kZWwuaG9zdCA9ICcnXG5cbkluY2x1ZGUgPVxuICBhamF4OiAtPiBuZXcgU2luZ2xldG9uKHRoaXMpXG5cbiAgdXJsOiAoYXJncy4uLikgLT5cbiAgICB1cmwgPSBBamF4LmdldFVSTChAY29uc3RydWN0b3IpXG4gICAgdXJsICs9ICcvJyB1bmxlc3MgdXJsLmNoYXJBdCh1cmwubGVuZ3RoIC0gMSkgaXMgJy8nXG4gICAgdXJsICs9IGVuY29kZVVSSUNvbXBvbmVudChAaWQpXG4gICAgYXJncy51bnNoaWZ0KHVybClcbiAgICBhcmdzLmpvaW4oJy8nKVxuXG5FeHRlbmQgPVxuICBhamF4OiAtPiBuZXcgQ29sbGVjdGlvbih0aGlzKVxuXG4gIHVybDogKGFyZ3MuLi4pIC0+XG4gICAgYXJncy51bnNoaWZ0KEBjbGFzc05hbWUudG9Mb3dlckNhc2UoKSArICdzJylcbiAgICBhcmdzLnVuc2hpZnQoTW9kZWwuaG9zdClcbiAgICBhcmdzLmpvaW4oJy8nKVxuXG5Nb2RlbC5BamF4ID1cbiAgZXh0ZW5kZWQ6IC0+XG4gICAgQGZldGNoIEBhamF4RmV0Y2hcbiAgICBAY2hhbmdlIEBhamF4Q2hhbmdlXG5cbiAgICBAZXh0ZW5kIEV4dGVuZFxuICAgIEBpbmNsdWRlIEluY2x1ZGVcblxuICAjIFByaXZhdGVcblxuICBhamF4RmV0Y2g6IC0+XG4gICAgQGFqYXgoKS5mZXRjaChhcmd1bWVudHMuLi4pXG5cbiAgYWpheENoYW5nZTogKHJlY29yZCwgdHlwZSwgb3B0aW9ucyA9IHt9KSAtPlxuICAgIHJldHVybiBpZiBvcHRpb25zLmFqYXggaXMgZmFsc2VcbiAgICByZWNvcmQuYWpheCgpW3R5cGVdKG9wdGlvbnMuYWpheCwgb3B0aW9ucylcblxuTW9kZWwuQWpheC5NZXRob2RzID1cbiAgZXh0ZW5kZWQ6IC0+XG4gICAgQGV4dGVuZCBFeHRlbmRcbiAgICBAaW5jbHVkZSBJbmNsdWRlXG5cbiMgR2xvYmFsc1xuQWpheC5kZWZhdWx0cyAgID0gQmFzZTo6ZGVmYXVsdHNcblNwaW5lLkFqYXggICAgICA9IEFqYXhcbm1vZHVsZT8uZXhwb3J0cyA9IEFqYXgiXX0=
// Generated by CoffeeScript 1.6.1
(function() {
  var $, Ajax, Base, Collection, Extend, Include, Model, Queue, Singleton, Spine,
    _this = this,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __slice = [].slice;

  Spine = this.Spine || require('spine');

  $ = Spine.$;

  Model = Spine.Model;

  Queue = $({});

  Ajax = {
    getURL: function(object) {
      return object && (typeof object.url === "function" ? object.url() : void 0) || object.url;
    },
    enabled: true,
    disable: function(callback) {
      if (this.enabled) {
        this.enabled = false;
        try {
          return callback();
        } catch (e) {
          throw e;
        } finally {
          this.enabled = true;
        }
      } else {
        return callback();
      }
    },
    queue: function(request) {
      if (request) {
        return Queue.queue(request);
      } else {
        return Queue.queue();
      }
    },
    clearQueue: function() {
      return this.queue([]);
    }
  };

  Base = (function() {

    function Base() {}

    Base.prototype.defaults = {
      contentType: 'application/json',
      dataType: 'json',
      processData: false,
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    };

    Base.prototype.queue = Ajax.queue;

    Base.prototype.ajax = function(params, defaults) {
      return $.ajax(this.ajaxSettings(params, defaults));
    };

    Base.prototype.ajaxQueue = function(params, defaults) {
      var deferred, jqXHR, promise, request, settings;
      jqXHR = null;
      deferred = $.Deferred();
      promise = deferred.promise();
      if (!Ajax.enabled) {
        return promise;
      }
      settings = this.ajaxSettings(params, defaults);
      request = function(next) {
        return jqXHR = $.ajax(settings).done(deferred.resolve).fail(deferred.reject).then(next, next);
      };
      promise.abort = function(statusText) {
        var index;
        if (jqXHR) {
          return jqXHR.abort(statusText);
        }
        index = $.inArray(request, this.queue());
        if (index > -1) {
          this.queue().splice(index, 1);
        }
        deferred.rejectWith(settings.context || settings, [promise, statusText, '']);
        return promise;
      };
      this.queue(request);
      return promise;
    };

    Base.prototype.ajaxSettings = function(params, defaults) {
      return $.extend({}, this.defaults, defaults, params);
    };

    return Base;

  })();

  Collection = (function(_super) {

    __extends(Collection, _super);

    function Collection(model) {
      var _this = this;
      this.model = model;
      this.failResponse = function(xhr, statusText, error) {
        return Collection.prototype.failResponse.apply(_this, arguments);
      };
      this.recordsResponse = function(data, status, xhr) {
        return Collection.prototype.recordsResponse.apply(_this, arguments);
      };
    }

    Collection.prototype.find = function(id, params) {
      var record;
      record = new this.model({
        id: id
      });
      return this.ajaxQueue(params, {
        type: 'GET',
        url: Ajax.getURL(record)
      }).done(this.recordsResponse).fail(this.failResponse);
    };

    Collection.prototype.all = function(params) {
      return this.ajaxQueue(params, {
        type: 'GET',
        url: Ajax.getURL(this.model)
      }).done(this.recordsResponse).fail(this.failResponse);
    };

    Collection.prototype.fetch = function(params, options) {
      var id,
        _this = this;
      if (params == null) {
        params = {};
      }
      if (options == null) {
        options = {};
      }
      if (id = params.id) {
        delete params.id;
        return this.find(id, params).done(function(record) {
          return _this.model.refresh(record, options);
        });
      } else {
        return this.all(params).done(function(records) {
          return _this.model.refresh(records, options);
        });
      }
    };

    Collection.prototype.recordsResponse = function(data, status, xhr) {
      return this.model.trigger('ajaxSuccess', null, status, xhr);
    };

    Collection.prototype.failResponse = function(xhr, statusText, error) {
      return this.model.trigger('ajaxError', null, xhr, statusText, error);
    };

    return Collection;

  })(Base);

  Singleton = (function(_super) {

    __extends(Singleton, _super);

    function Singleton(record) {
      var _this = this;
      this.record = record;
      this.failResponse = function(options) {
        if (options == null) {
          options = {};
        }
        return Singleton.prototype.failResponse.apply(_this, arguments);
      };
      this.recordResponse = function(options) {
        if (options == null) {
          options = {};
        }
        return Singleton.prototype.recordResponse.apply(_this, arguments);
      };
      this.model = this.record.constructor;
    }

    Singleton.prototype.reload = function(params, options) {
      return this.ajaxQueue(params, {
        type: 'GET',
        url: Ajax.getURL(this.record)
      }).done(this.recordResponse(options)).fail(this.failResponse(options));
    };

    Singleton.prototype.create = function(params, options) {
      return this.ajaxQueue(params, {
        type: 'POST',
        data: JSON.stringify(this.record),
        url: Ajax.getURL(this.model)
      }).done(this.recordResponse(options)).fail(this.failResponse(options));
    };

    Singleton.prototype.update = function(params, options) {
      return this.ajaxQueue(params, {
        type: 'PUT',
        data: JSON.stringify(this.record),
        url: Ajax.getURL(this.record)
      }).done(this.recordResponse(options)).fail(this.failResponse(options));
    };

    Singleton.prototype.destroy = function(params, options) {
      return this.ajaxQueue(params, {
        type: 'DELETE',
        url: Ajax.getURL(this.record)
      }).done(this.recordResponse(options)).fail(this.failResponse(options));
    };

    Singleton.prototype.recordResponse = function(options) {
      var _this = this;
      if (options == null) {
        options = {};
      }
      return function(data, status, xhr) {
        var _ref, _ref1;
        if (Spine.isBlank(data) || _this.record.destroyed) {
          data = false;
        } else {
          data = _this.model.fromJSON(data);
        }
        Ajax.disable(function() {
          if (data) {
            if (data.id && _this.record.id !== data.id) {
              _this.record.changeID(data.id);
            }
            return _this.record.updateAttributes(data.attributes());
          }
        });
        _this.record.trigger('ajaxSuccess', data, status, xhr);
        if ((_ref = options.success) != null) {
          _ref.apply(_this.record);
        }
        return (_ref1 = options.done) != null ? _ref1.apply(_this.record) : void 0;
      };
    };

    Singleton.prototype.failResponse = function(options) {
      var _this = this;
      if (options == null) {
        options = {};
      }
      return function(xhr, statusText, error) {
        var _ref, _ref1;
        _this.record.trigger('ajaxError', xhr, statusText, error);
        if ((_ref = options.error) != null) {
          _ref.apply(_this.record);
        }
        return (_ref1 = options.fail) != null ? _ref1.apply(_this.record) : void 0;
      };
    };

    return Singleton;

  })(Base);

  Model.host = '';

  Include = {
    ajax: function() {
      return new Singleton(this);
    },
    url: function() {
      var args, url;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      url = Ajax.getURL(this.constructor);
      if (url.charAt(url.length - 1) !== '/') {
        url += '/';
      }
      url += encodeURIComponent(this.id);
      args.unshift(url);
      return args.join('/');
    }
  };

  Extend = {
    ajax: function() {
      return new Collection(this);
    },
    url: function() {
      var args;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      args.unshift(this.className.toLowerCase() + 's');
      args.unshift(Model.host);
      return args.join('/');
    }
  };

  Model.Ajax = {
    extended: function() {
      this.fetch(this.ajaxFetch);
      this.change(this.ajaxChange);
      this.extend(Extend);
      return this.include(Include);
    },
    ajaxFetch: function() {
      var _ref;
      return (_ref = this.ajax()).fetch.apply(_ref, arguments);
    },
    ajaxChange: function(record, type, options) {
      if (options == null) {
        options = {};
      }
      if (options.ajax === false) {
        return;
      }
      return record.ajax()[type](options.ajax, options);
    }
  };

  Model.Ajax.Methods = {
    extended: function() {
      this.extend(Extend);
      return this.include(Include);
    }
  };

  Ajax.defaults = Base.prototype.defaults;

  Spine.Ajax = Ajax;

  if (typeof module !== "undefined" && module !== null) {
    module.exports = Ajax;
  }

}).call(this);
